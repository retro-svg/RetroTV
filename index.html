<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RetroTV - Stream Like It's 1999</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background: linear-gradient(135deg, #500, #100, #000);
            background-size: 400% 400%;
            animation: gradient-scroll 15s ease infinite;
            color: white;
            overflow: hidden;
            height: 100vh;
        }

        @keyframes gradient-scroll {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .loading-screen {
            position: fixed;
            inset: 0;
            background: #000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.5s;
        }

        .loading-screen.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .loading-text {
            font-size: 2rem;
            margin-bottom: 20px;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .start-prompt {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 2rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.7);
            z-index: 200;
            animation: blink 1.5s infinite;
            cursor: pointer;
        }

        @keyframes blink {
            0%, 49% { opacity: 1; }
            50%, 100% { opacity: 0; }
        }

        .start-prompt.hidden {
            display: none;
        }

        .logo {
            width: 300px;
            height: 200px;
            background: linear-gradient(45deg, #ff4444, #ff8844);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            font-weight: bold;
            border-radius: 20px;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.8);
            opacity: 0;
            z-index: 100;
            transition: all 0.7s;
        }

        /* Login/Register Panel */
        .auth-panel {
            position: fixed;
            inset: 0;
            background: rgba(20, 0, 0, 0.95);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 400;
        }

        .auth-panel.visible {
            display: flex;
        }

        .auth-box {
            background: rgba(0, 0, 0, 0.8);
            border: 3px solid #ff4444;
            padding: 40px;
            border-radius: 10px;
            max-width: 400px;
            width: 90%;
        }

        .auth-box h2 {
            font-size: 2.5rem;
            margin-bottom: 30px;
            text-align: center;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-size: 1.2rem;
        }

        .form-group input {
            width: 100%;
            padding: 12px;
            background: #111;
            border: 2px solid #333;
            color: white;
            font-size: 1.1rem;
            font-family: 'Courier New', monospace;
        }

        .form-group input:focus {
            outline: none;
            border-color: #ff4444;
        }

        .auth-button {
            width: 100%;
            padding: 15px;
            background: #ff4444;
            border: none;
            color: #000;
            font-size: 1.3rem;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            transition: all 0.2s;
            margin-top: 10px;
        }

        .auth-button:hover {
            background: #ff8844;
            transform: scale(1.02);
        }

        .auth-toggle {
            text-align: center;
            margin-top: 20px;
            font-size: 1rem;
            color: #aaa;
        }

        .auth-toggle a {
            color: #ff4444;
            cursor: pointer;
            text-decoration: underline;
        }

        .error-message {
            background: rgba(255, 0, 0, 0.2);
            border: 1px solid #ff4444;
            padding: 10px;
            margin-bottom: 15px;
            border-radius: 5px;
            display: none;
        }

        .user-info {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.7);
            padding: 10px 20px;
            border: 2px solid #ff4444;
            border-radius: 5px;
            z-index: 500;
            display: none;
        }

        .user-info.visible {
            display: block;
        }

        .user-info .username {
            color: #ff8844;
            font-weight: bold;
        }

        .user-info button {
            margin-left: 15px;
            padding: 5px 10px;
            background: #ff4444;
            border: none;
            color: #000;
            cursor: pointer;
            font-family: 'Courier New', monospace;
        }

        .main-menu {
            position: fixed;
            inset: 0;
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 30px;
            z-index: 50;
        }

        .main-menu.visible {
            display: flex;
        }

        .menu-button {
            background: none;
            border: 3px solid #ff4444;
            color: white;
            font-size: 2.5rem;
            padding: 20px 60px;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            transition: all 0.2s;
            position: relative;
            overflow: hidden;
        }

        .menu-button::before {
            content: '';
            position: absolute;
            inset: 0;
            background: #ff4444;
            transform: scaleX(0);
            transform-origin: left;
            transition: transform 0.3s;
            z-index: -1;
        }

        .menu-button:hover::before {
            transform: scaleX(1);
        }

        .menu-button:hover {
            color: #000;
            border-color: #ff8844;
            text-shadow: none;
        }

        .tv-container {
            position: fixed;
            inset: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            perspective: 1000px;
            opacity: 0;
            pointer-events: none;
            transition: opacity 1s;
        }

        .tv-container.visible {
            opacity: 1;
            pointer-events: all;
        }

        .tv-screen {
            width: 70vw;
            max-width: 960px;
            aspect-ratio: 4/3;
            background: #111;
            border: 20px solid #333;
            border-radius: 30px;
            box-shadow: 0 0 40px rgba(0,0,0,0.8), inset 0 0 20px rgba(0,0,0,1);
            position: relative;
            overflow: hidden;
            transition: transform 0.1s;
        }

        .screen-reflection {
            position: absolute;
            inset: 0;
            background: linear-gradient(to bottom, rgba(255,255,255,0.1) 0%, transparent 20%);
            pointer-events: none;
            z-index: 10;
        }

        .tv-static {
            position: absolute;
            inset: 0;
            background: repeating-linear-gradient(
                0deg,
                #000 0px,
                #111 1px,
                #000 2px
            );
            animation: static 0.1s infinite;
            z-index: 1;
        }

        @keyframes static {
            0% { transform: translateY(0); }
            100% { transform: translateY(10px); }
        }

        .video-player {
            position: absolute;
            inset: 0;
            width: 100%;
            height: 100%;
            object-fit: contain;
            background: #000;
            opacity: 0;
            transition: opacity 0.5s;
            z-index: 2;
        }

        .video-player.visible {
            opacity: 1;
        }

        .channel-display {
            position: absolute;
            bottom: 25px;
            right: 35px;
            font-size: 1.5rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,1);
            z-index: 5;
            opacity: 0;
            transition: opacity 0.5s;
        }

        .channel-display.visible {
            opacity: 1;
        }

        .uploader-watermark {
            position: absolute;
            bottom: 25px;
            left: 35px;
            font-size: 1rem;
            color: rgba(255, 255, 255, 0.6);
            text-shadow: 1px 1px 2px rgba(0,0,0,1);
            z-index: 5;
            opacity: 0;
            transition: opacity 0.5s;
        }

        .uploader-watermark.visible {
            opacity: 1;
        }

        .controls {
            position: fixed;
            right: 5vw;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
            gap: 20px;
            z-index: 100;
            opacity: 0;
            transition: opacity 1s;
        }

        .controls.visible {
            opacity: 1;
        }

        .control-btn {
            background: rgba(20, 0, 0, 0.8);
            border: 2px solid #ff4444;
            color: white;
            font-size: 1.5rem;
            padding: 15px 25px;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            transition: all 0.2s;
        }

        .control-btn:hover {
            background: #ff4444;
            color: #000;
            transform: scale(1.05);
        }

        .hint-box {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 1.5rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.7);
            opacity: 0;
            transition: opacity 0.3s;
            text-align: center;
            max-width: 80%;
        }

        .settings-panel, .upload-panel, .moderator-panel {
            position: fixed;
            inset: 0;
            background: rgba(20, 0, 0, 0.95);
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: center;
            z-index: 300;
            transform: translateX(100vw);
            transition: transform 0.7s;
            overflow-y: auto;
            padding: 40px 20px;
        }

        .settings-panel.visible, .upload-panel.visible, .moderator-panel.visible {
            transform: translateX(0);
        }

        .settings-panel h2, .upload-panel h2, .moderator-panel h2 {
            font-size: 3rem;
            margin-bottom: 30px;
        }

        .setting-item {
            display: flex;
            align-items: center;
            gap: 20px;
            margin: 15px 0;
            font-size: 1.5rem;
        }

        .setting-item label {
            min-width: 150px;
        }

        input[type="range"] {
            width: 250px;
            height: 15px;
            background: #555;
            border-radius: 8px;
            outline: none;
            cursor: pointer;
        }

        .back-button {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(20, 0, 0, 0.8);
            border: 2px solid #ff4444;
            color: white;
            font-size: 1.5rem;
            padding: 10px 30px;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            transition: all 0.2s;
        }

        .back-button:hover {
            background: #ff4444;
            color: #000;
        }

        /* Upload Panel Styles */
        .upload-form {
            max-width: 600px;
            width: 100%;
        }

        .upload-form input[type="file"],
        .upload-form input[type="text"],
        .upload-form textarea {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            background: #111;
            border: 2px solid #333;
            color: white;
            font-family: 'Courier New', monospace;
            font-size: 1.1rem;
        }

        .upload-form textarea {
            resize: vertical;
            min-height: 100px;
        }

        .upload-rules {
            background: rgba(255, 0, 0, 0.1);
            border: 2px solid #ff4444;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 5px;
        }

        .upload-rules h3 {
            margin-bottom: 10px;
        }

        .upload-rules ul {
            margin-left: 20px;
        }

        .upload-rules li {
            margin: 5px 0;
        }

        /* Video Feed */
        .video-feed {
            max-width: 800px;
            width: 100%;
            margin-top: 40px;
        }

        .video-feed h3 {
            font-size: 2rem;
            margin-bottom: 20px;
        }

        .feed-item {
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid #333;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 5px;
            display: flex;
            gap: 15px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .feed-item:hover {
            border-color: #ff4444;
            background: rgba(255, 68, 68, 0.1);
        }

        .feed-item video {
            width: 200px;
            height: 112px;
            object-fit: cover;
            background: #000;
            flex-shrink: 0;
        }

        .feed-item-info {
            flex: 1;
        }

        .feed-item-title {
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .feed-item-uploader {
            color: #ff8844;
            margin-bottom: 5px;
        }

        .feed-item-description {
            color: #aaa;
            font-size: 0.9rem;
        }

        .feed-item-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .report-btn, .delete-btn {
            padding: 5px 15px;
            background: rgba(255, 0, 0, 0.3);
            border: 1px solid #ff4444;
            color: white;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
        }

        .report-btn:hover {
            background: #ff4444;
            color: #000;
        }

        .delete-btn {
            background: rgba(139, 0, 0, 0.5);
        }

        .delete-btn:hover {
            background: #8b0000;
        }

        /* Moderator Panel */
        .reports-list {
            max-width: 900px;
            width: 100%;
        }

        .report-item {
            background: rgba(139, 0, 0, 0.3);
            border: 2px solid #ff4444;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 5px;
        }

        .report-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            font-size: 0.9rem;
            color: #aaa;
        }

        .report-video {
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 10px;
            color: #ff8844;
        }

        .report-reason {
            background: rgba(0, 0, 0, 0.5);
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 15px;
            white-space: pre-wrap;
        }

        .report-actions {
            display: flex;
            gap: 10px;
        }

        .report-actions button {
            padding: 10px 20px;
            background: #ff4444;
            border: none;
            color: #000;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            font-weight: bold;
        }

        .report-actions button:hover {
            background: #ff8844;
        }

        .badge-admin {
            background: #ff4444;
            color: #000;
            padding: 2px 8px;
            border-radius: 3px;
            font-size: 0.8rem;
            font-weight: bold;
            margin-left: 10px;
        }

        @media (max-width: 768px) {
            .menu-button {
                font-size: 1.8rem;
                padding: 15px 40px;
            }

            .tv-screen {
                width: 90vw;
            }

            .controls {
                bottom: 20px;
                top: auto;
                right: 50%;
                transform: translate(50%, 0);
                flex-direction: row;
            }

            .feed-item {
                flex-direction: column;
            }

            .feed-item video {
                width: 100%;
                height: auto;
            }
        }
    </style>
</head>
<body>
    <div class="loading-screen">
        <div class="loading-text">LOADING RETROTV...</div>
    </div>

    <div class="start-prompt">CLICK ANYWHERE TO START</div>

    <div class="logo">üì∫</div>

    <!-- User Info Display -->
    <div class="user-info">
        <span class="username"></span>
        <button onclick="logout()">Logout</button>
    </div>

    <!-- Auth Panel -->
    <div class="auth-panel">
        <div class="auth-box">
            <h2 id="authTitle">LOGIN</h2>
            <div class="error-message" id="authError"></div>
            <form id="authForm">
                <div class="form-group">
                    <label>Username:</label>
                    <input type="text" id="authUsername" required>
                </div>
                <div class="form-group">
                    <label>Password:</label>
                    <input type="password" id="authPassword" required>
                </div>
                <button type="submit" class="auth-button" id="authSubmit">LOGIN</button>
            </form>
            <div class="auth-toggle">
                <span id="authToggleText">Don't have an account? </span>
                <a id="authToggleLink">Register</a>
            </div>
        </div>
    </div>

    <div class="main-menu">
        <div class="menu-button" data-action="play">‚ñ∂ PLAY</div>
        <div class="menu-button" data-action="upload">üì§ UPLOAD</div>
        <div class="menu-button" data-action="settings">‚öô SETTINGS</div>
        <div class="menu-button" data-action="moderator" id="moderatorBtn" style="display: none;">üõ°Ô∏è MODERATOR</div>
    </div>

    <div class="tv-container">
        <div class="tv-screen" id="tvScreen">
            <div class="screen-reflection"></div>
            <div class="tv-static"></div>
            <video class="video-player" id="videoPlayer" loop>
                <source src="placeholder-video.mp4" type="video/mp4">
            </video>
            <div class="channel-display" id="channelDisplay">CH 1 | Loading...</div>
            <div class="uploader-watermark" id="uploaderWatermark">Uploaded by: User</div>
        </div>
    </div>

    <div class="controls">
        <button class="control-btn" data-action="ch-up">CH ‚ñ≤</button>
        <button class="control-btn" data-action="ch-down">CH ‚ñº</button>
        <button class="control-btn" data-action="report">üö´ REPORT</button>
        <button class="control-btn" data-action="menu">MENU</button>
    </div>

    <div class="settings-panel">
        <h2>SETTINGS</h2>
        <div class="setting-item">
            <label>Volume:</label>
            <input type="range" id="volumeSlider" min="0" max="100" value="50">
        </div>
        <div class="setting-item">
            <label>Brightness:</label>
            <input type="range" id="brightnessSlider" min="0" max="100" value="100">
        </div>
        <button class="back-button" data-action="close-settings">‚Üê BACK</button>
    </div>

    <!-- Upload Panel -->
    <div class="upload-panel">
        <h2>UPLOAD VIDEO</h2>
        <button class="back-button" data-action="close-upload">‚Üê BACK</button>
        
        <div class="upload-form">
            <div class="upload-rules">
                <h3>üìã Upload Rules:</h3>
                <ul>
                    <li>No copyrighted content without permission</li>
                    <li>Keep content appropriate and legal</li>
                    <li>Max file size: 100MB (simulated)</li>
                    <li>Supported formats: MP4, WebM, OGG</li>
                </ul>
            </div>

            <label>Video File:</label>
            <input type="file" id="uploadFile" accept="video/*">

            <label>Title:</label>
            <input type="text" id="uploadTitle" placeholder="Enter video title" required>

            <label>Description:</label>
            <textarea id="uploadDescription" placeholder="Optional description"></textarea>

            <button class="auth-button" onclick="submitUpload()">UPLOAD VIDEO</button>
        </div>

        <div class="video-feed">
            <h3>üì∫ Community Uploads</h3>
            <div id="uploadFeed"></div>
        </div>
    </div>

    <!-- Moderator Panel -->
    <div class="moderator-panel">
        <h2>üõ°Ô∏è MODERATOR PANEL</h2>
        <button class="back-button" data-action="close-moderator">‚Üê BACK</button>
        
        <div class="reports-list" id="reportsList">
            <p style="text-align: center; color: #aaa;">No reports yet.</p>
        </div>
    </div>

    <div class="hint-box" id="hintBox"></div>

    <script>
        // Database simulation (In production, use a real backend)
        const DB = {
            users: JSON.parse(localStorage.getItem('retrotv_users') || '[]'),
            videos: JSON.parse(localStorage.getItem('retrotv_videos') || '[]'),
            reports: JSON.parse(localStorage.getItem('retrotv_reports') || '[]'),
            
            save() {
                localStorage.setItem('retrotv_users', JSON.stringify(this.users));
                localStorage.setItem('retrotv_videos', JSON.stringify(this.videos));
                localStorage.setItem('retrotv_reports', JSON.stringify(this.reports));
            }
        };

        // State management
        const state = {
            currentUser: JSON.parse(localStorage.getItem('retrotv_currentUser') || 'null'),
            currentChannel: 0,
            channels: [
                { name: 'Abstract Art', url: 'placeholder1.mp4', uploader: '@retro', isDefault: true },
                { name: 'Retro Gaming', url: 'placeholder2.mp4', uploader: '@retro', isDefault: true },
                { name: 'Vaporwave', url: 'placeholder3.mp4', uploader: '@retro', isDefault: true },
                { name: 'Lo-Fi Beats', url: 'placeholder4.mp4', uploader: '@retro', isDefault: true },
                { name: 'Classic TV', url: 'placeholder5.mp4', uploader: '@retro', isDefault: true }
            ],
            channelHistory: JSON.parse(localStorage.getItem('retrotv_history') || '[]'),
            hasStarted: false,
            isAuthMode: 'login'
        };

        // Weighted random channel selection
        function getWeightedRandomChannel() {
            const now = Date.now();
            const DECAY_TIME = 30 * 60 * 1000; // 30 minutes
            
            // Calculate weights for each channel
            const weights = state.channels.map((channel, index) => {
                const lastWatched = state.channelHistory.find(h => h.index === index);
                
                if (!lastWatched) {
                    return 1.0; // Never watched = full weight
                }
                
                const timeSinceWatched = now - lastWatched.timestamp;
                const weight = Math.min(1.0, timeSinceWatched / DECAY_TIME);
                
                return Math.max(0.1, weight); // Minimum 10% chance
            });
            
            // Random weighted selection
            const totalWeight = weights.reduce((sum, w) => sum + w, 0);
            let random = Math.random() * totalWeight;
            
            for (let i = 0; i < weights.length; i++) {
                random -= weights[i];
                if (random <= 0) {
                    return i;
                }
            }
            
            return 0; // Fallback
        }

        function markChannelWatched(channelIndex) {
            const existingIndex = state.channelHistory.findIndex(h => h.index === channelIndex);
            
            if (existingIndex !== -1) {
                state.channelHistory[existingIndex].timestamp = Date.now();
            } else {
                state.channelHistory.push({
                    index: channelIndex,
                    timestamp: Date.now()
                });
            }
            
            localStorage.setItem('retrotv_history', JSON.stringify(state.channelHistory));
        }

        // Load user videos into channels
        function loadUserVideos() {
            // Remove old user videos
            state.channels = state.channels.filter(ch => ch.isDefault);
            
            // Add user videos
            DB.videos.forEach(video => {
                state.channels.push({
                    name: video.title,
                    url: video.url,
                    uploader: video.uploader,
                    description: video.description,
                    id: video.id,
                    isDefault: false
                });
            });
        }

        // Elements
        const loadingScreen = document.querySelector('.loading-screen');
        const startPrompt = document.querySelector('.start-prompt');
        const logo = document.querySelector('.logo');
        const authPanel = document.querySelector('.auth-panel');
        const mainMenu = document.querySelector('.main-menu');
        const tvContainer = document.querySelector('.tv-container');
        const tvScreen = document.getElementById('tvScreen');
        const videoPlayer = document.getElementById('videoPlayer');
        const channelDisplay = document.getElementById('channelDisplay');
        const uploaderWatermark = document.getElementById('uploaderWatermark');
        const controls = document.querySelector('.controls');
        const settingsPanel = document.querySelector('.settings-panel');
        const uploadPanel = document.querySelector('.upload-panel');
        const moderatorPanel = document.querySelector('.moderator-panel');
        const hintBox = document.getElementById('hintBox');
        const volumeSlider = document.getElementById('volumeSlider');
        const brightnessSlider = document.getElementById('brightnessSlider');
        const userInfo = document.querySelector('.user-info');

        // Initialize
        window.addEventListener('load', () => {
            setTimeout(() => {
                loadingScreen.classList.add('hidden');
                if (state.currentUser) {
                    updateUserDisplay();
                    loadUserVideos();
                }
            }, 1000);
        });

        // Start sequence
        function startSequence() {
            if (state.hasStarted) return;
            state.hasStarted = true;
            
            startPrompt.classList.add('hidden');
            
            // Check if user is logged in
            if (!state.currentUser) {
                showAuth();
                return;
            }
            
            // Animate logo
            logo.style.opacity = '1';
            logo.style.transform = 'translate(-50%, -50%) scale(1)';
            
            setTimeout(() => {
                logo.style.transform = 'translate(-50%, -50%) scale(1.2) rotate(360deg)';
            }, 500);
            
            setTimeout(() => {
                logo.style.transform = 'translate(-50%, 120vh) rotate(720deg)';
                logo.style.opacity = '0';
            }, 1500);
            
            setTimeout(() => {
                mainMenu.classList.add('visible');
            }, 2000);
        }

        document.addEventListener('click', startSequence, { once: true });

        // Auth functions
        function showAuth() {
            authPanel.classList.add('visible');
        }

        function hideAuth() {
            authPanel.classList.remove('visible');
        }

        function updateUserDisplay() {
            if (state.currentUser) {
                userInfo.classList.add('visible');
                const usernameSpan = userInfo.querySelector('.username');
                usernameSpan.textContent = state.currentUser.username;
                
                if (state.currentUser.username === '@retro') {
                    usernameSpan.innerHTML += '<span class="badge-admin">ADMIN</span>';
                    document.getElementById('moderatorBtn').style.display = 'block';
                }
            } else {
                userInfo.classList.remove('visible');
                document.getElementById('moderatorBtn').style.display = 'none';
            }
        }

        // Auth form handling
        document.getElementById('authToggleLink').addEventListener('click', () => {
            state.isAuthMode = state.isAuthMode === 'login' ? 'register' : 'login';
            
            if (state.isAuthMode === 'register') {
                document.getElementById('authTitle').textContent = 'REGISTER';
                document.getElementById('authSubmit').textContent = 'REGISTER';
                document.getElementById('authToggleText').textContent = 'Already have an account? ';
                document.getElementById('authToggleLink').textContent = 'Login';
            } else {
                document.getElementById('authTitle').textContent = 'LOGIN';
                document.getElementById('authSubmit').textContent = 'LOGIN';
                document.getElementById('authToggleText').textContent = "Don't have an account? ";
                document.getElementById('authToggleLink').textContent = 'Register';
            }
            
            document.getElementById('authError').style.display = 'none';
        });

        document.getElementById('authForm').addEventListener('submit', (e) => {
            e.preventDefault();
            
            const username = document.getElementById('authUsername').value.trim();
            const password = document.getElementById('authPassword').value;
            const errorEl = document.getElementById('authError');
            
            errorEl.style.display = 'none';
            
            if (state.isAuthMode === 'register') {
                // Check if username exists
                if (DB.users.find(u => u.username === username)) {
                    errorEl.textContent = 'Username already taken!';
                    errorEl.style.display = 'block';
                    return;
                }
                
                // Check if username is reserved
                if (username === '@retro') {
                    errorEl.textContent = 'This username is reserved for the administrator!';
                    errorEl.style.display = 'block';
                    return;
                }
                
                // Register user
                const newUser = { username, password };
                DB.users.push(newUser);
                DB.save();
                
                state.currentUser = newUser;
                localStorage.setItem('retrotv_currentUser', JSON.stringify(newUser));
                
                showHint('Account created successfully!');
                hideAuth();
                updateUserDisplay();
                
                // Animate logo after registration
                logo.style.opacity = '1';
                logo.style.transform = 'translate(-50%, -50%) scale(1)';
                
                setTimeout(() => {
                    logo.style.transform = 'translate(-50%, -50%) scale(1.2) rotate(360deg)';
                }, 500);
                
                setTimeout(() => {
                    logo.style.transform = 'translate(-50%, 120vh) rotate(720deg)';
                    logo.style.opacity = '0';
                }, 1500);
                
                setTimeout(() => {
                    mainMenu.classList.add('visible');
                }, 2000);
                
            } else {
                // Login
                const user = DB.users.find(u => u.username === username && u.password === password);
                
                if (!user) {
                    errorEl.textContent = 'Invalid username or password!';
                    errorEl.style.display = 'block';
                    return;
                }
                
                state.currentUser = user;
                localStorage.setItem('retrotv_currentUser', JSON.stringify(user));
                
                showHint('Logged in successfully!');
                hideAuth();
                updateUserDisplay();
                loadUserVideos();
                
                // Animate logo after login
                logo.style.opacity = '1';
                logo.style.transform = 'translate(-50%, -50%) scale(1)';
                
                setTimeout(() => {
                    logo.style.transform = 'translate(-50%, -50%) scale(1.2) rotate(360deg)';
                }, 500);
                
                setTimeout(() => {
                    logo.style.transform = 'translate(-50%, 120vh) rotate(720deg)';
                    logo.style.opacity = '0';
                }, 1500);
                
                setTimeout(() => {
                    mainMenu.classList.add('visible');
                }, 2000);
            }
            
            document.getElementById('authUsername').value = '';
            document.getElementById('authPassword').value = '';
        });

        function logout() {
            state.currentUser = null;
            localStorage.removeItem('retrotv_currentUser');
            updateUserDisplay();
            location.reload();
        }

        // Event listeners
        document.querySelectorAll('[data-action]').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const action = e.target.dataset.action;
                handleAction(action);
            });
        });

        function handleAction(action) {
            switch(action) {
                case 'play':
                    startTV();
                    break;
                case 'settings':
                    showSettings();
                    break;
                case 'upload':
                    showUpload();
                    break;
                case 'moderator':
                    showModerator();
                    break;
                case 'ch-up':
                    changeChannel(1);
                    break;
                case 'ch-down':
                    changeChannel(-1);
                    break;
                case 'report':
                    reportVideo();
                    break;
                case 'menu':
                    backToMenu();
                    break;
                case 'close-settings':
                    hideSettings();
                    break;
                case 'close-upload':
                    hideUpload();
                    break;
                case 'close-moderator':
                    hideModerator();
                    break;
            }
        }

        function startTV() {
            mainMenu.classList.remove('visible');
            tvContainer.classList.add('visible');
            
            setTimeout(() => {
                controls.classList.add('visible');
                // Start with a random weighted channel
                state.currentChannel = getWeightedRandomChannel();
                loadChannel(state.currentChannel);
            }, 1000);
        }

        function loadChannel(index) {
            const channel = state.channels[index];
            
            // Mark this channel as watched
            markChannelWatched(index);
            
            // Show static
            videoPlayer.classList.remove('visible');
            channelDisplay.classList.remove('visible');
            uploaderWatermark.classList.remove('visible');
            
            setTimeout(() => {
                // Update channel info
                channelDisplay.textContent = `CH ${index + 1} | ${channel.name}`;
                uploaderWatermark.textContent = `Uploaded by: ${channel.uploader}`;
                
                // Load video
                videoPlayer.src = channel.url;
                
                // Hide static, show video
                setTimeout(() => {
                    videoPlayer.classList.add('visible');
                    channelDisplay.classList.add('visible');
                    if (!channel.isDefault) {
                        uploaderWatermark.classList.add('visible');
                    }
                    videoPlayer.play().catch(() => {
                        showHint('Video playback requires user interaction');
                    });
                }, 500);
            }, 1000);
        }

        function changeChannel(direction) {
            if (direction === 1) {
                // Channel up - random weighted selection
                state.currentChannel = getWeightedRandomChannel();
            } else {
                // Channel down - random weighted selection (same behavior)
                state.currentChannel = getWeightedRandomChannel();
            }
            
            loadChannel(state.currentChannel);
        }

        function reportVideo() {
            const channel = state.channels[state.currentChannel];
            
            if (channel.isDefault) {
                showHint("Cannot report default channels");
                return;
            }
            
            const reason = prompt("Why are you reporting this video?");
            
            if (!reason || reason.trim() === '') {
                return;
            }
            
            const report = {
                id: Date.now(),
                videoId: channel.id,
                videoTitle: channel.name,
                videoUploader: channel.uploader,
                reportedBy: state.currentUser.username,
                reason: reason,
                timestamp: new Date().toISOString()
            };
            
            DB.reports.push(report);
            DB.save();
            
            showHint('Report submitted. Thank you!');
        }

        function showSettings() {
            settingsPanel.classList.add('visible');
        }

        function hideSettings() {
            settingsPanel.classList.remove('visible');
        }

        function showUpload() {
            uploadPanel.classList.add('visible');
            renderUploadFeed();
        }

        function hideUpload() {
            uploadPanel.classList.remove('visible');
        }

        function showModerator() {
            if (state.currentUser.username !== '@retro') {
                showHint('Access denied: Moderator only');
                return;
            }
            moderatorPanel.classList.add('visible');
            renderReports();
        }

        function hideModerator() {
            moderatorPanel.classList.remove('visible');
        }

        function backToMenu() {
            tvContainer.classList.remove('visible');
            controls.classList.remove('visible');
            videoPlayer.pause();
            
            setTimeout(() => {
                mainMenu.classList.add('visible');
            }, 500);
        }

        function showHint(text) {
            hintBox.textContent = text;
            hintBox.style.opacity = '1';
            
            setTimeout(() => {
                hintBox.style.opacity = '0';
            }, 3000);
        }

        // Upload functionality
        function submitUpload() {
            const fileInput = document.getElementById('uploadFile');
            const title = document.getElementById('uploadTitle').value.trim();
            const description = document.getElementById('uploadDescription').value.trim();
            
            if (!fileInput.files[0]) {
                showHint('Please select a video file');
                return;
            }
            
            if (!title) {
                showHint('Please enter a title');
                return;
            }
            
            // In production, upload file to server
            // For demo, we'll use a data URL
            const file = fileInput.files[0];
            const reader = new FileReader();
            
            reader.onload = (e) => {
                const video = {
                    id: Date.now(),
                    title: title,
                    description: description,
                    url: e.target.result,
                    uploader: state.currentUser.username,
                    timestamp: new Date().toISOString()
                };
                
                DB.videos.push(video);
                DB.save();
                
                state.channels.push({
                    name: title,
                    url: e.target.result,
                    uploader: state.currentUser.username,
                    description: description,
                    id: video.id,
                    isDefault: false
                });
                
                showHint('Video uploaded successfully!');
                
                // Clear form
                fileInput.value = '';
                document.getElementById('uploadTitle').value = '';
                document.getElementById('uploadDescription').value = '';
                
                renderUploadFeed();
            };
            
            reader.readAsDataURL(file);
        }

        function renderUploadFeed() {
            const feedEl = document.getElementById('uploadFeed');
            feedEl.innerHTML = '';
            
            if (DB.videos.length === 0) {
                feedEl.innerHTML = '<p style="text-align: center; color: #aaa;">No uploads yet</p>';
                return;
            }
            
            DB.videos.slice().reverse().forEach(video => {
                const item = document.createElement('div');
                item.className = 'feed-item';
                
                const videoEl = document.createElement('video');
                videoEl.src = video.url;
                videoEl.muted = true;
                videoEl.preload = 'metadata';
                videoEl.style.cursor = 'pointer';
                
                // Show first frame
                videoEl.addEventListener('loadedmetadata', () => {
                    videoEl.currentTime = 0.1;
                });
                
                const infoDiv = document.createElement('div');
                infoDiv.className = 'feed-item-info';
                
                const titleDiv = document.createElement('div');
                titleDiv.className = 'feed-item-title';
                titleDiv.textContent = video.title;
                
                const uploaderDiv = document.createElement('div');
                uploaderDiv.className = 'feed-item-uploader';
                uploaderDiv.textContent = `by ${video.uploader}`;
                
                const descDiv = document.createElement('div');
                descDiv.className = 'feed-item-description';
                descDiv.textContent = video.description || 'No description';
                
                const actionsDiv = document.createElement('div');
                actionsDiv.className = 'feed-item-actions';
                
                if (video.uploader === state.currentUser.username) {
                    const deleteBtn = document.createElement('button');
                    deleteBtn.className = 'delete-btn';
                    deleteBtn.textContent = 'Delete';
                    deleteBtn.onclick = (e) => {
                        e.stopPropagation();
                        deleteVideo(video.id);
                    };
                    actionsDiv.appendChild(deleteBtn);
                } else {
                    const reportBtn = document.createElement('button');
                    reportBtn.className = 'report-btn';
                    reportBtn.textContent = 'Report';
                    reportBtn.onclick = (e) => {
                        e.stopPropagation();
                        reportUploadedVideo(video.id);
                    };
                    actionsDiv.appendChild(reportBtn);
                }
                
                infoDiv.appendChild(titleDiv);
                infoDiv.appendChild(uploaderDiv);
                infoDiv.appendChild(descDiv);
                infoDiv.appendChild(actionsDiv);
                
                item.appendChild(videoEl);
                item.appendChild(infoDiv);
                
                // Click the entire item to play video
                item.style.cursor = 'pointer';
                item.addEventListener('click', () => {
                    playUploadedVideo(video.id);
                });
                
                feedEl.appendChild(item);
            });
        }

        function playUploadedVideo(videoId) {
            const videoIndex = state.channels.findIndex(ch => ch.id === videoId);
            if (videoIndex !== -1) {
                state.currentChannel = videoIndex;
                hideUpload();
                
                // If TV is already visible, just load the channel
                if (tvContainer.classList.contains('visible')) {
                    loadChannel(state.currentChannel);
                } else {
                    // Otherwise show TV first
                    mainMenu.classList.remove('visible');
                    tvContainer.classList.add('visible');
                    
                    setTimeout(() => {
                        controls.classList.add('visible');
                        loadChannel(state.currentChannel);
                    }, 1000);
                }
            }
        }

        function deleteVideo(videoId) {
            if (!confirm('Are you sure you want to delete this video?')) {
                return;
            }
            
            DB.videos = DB.videos.filter(v => v.id !== videoId);
            DB.save();
            
            state.channels = state.channels.filter(ch => ch.id !== videoId);
            
            renderUploadFeed();
            showHint('Video deleted');
        }

        function reportUploadedVideo(videoId) {
            const video = DB.videos.find(v => v.id === videoId);
            const reason = prompt("Why are you reporting this video?");
            
            if (!reason || reason.trim() === '') {
                return;
            }
            
            const report = {
                id: Date.now(),
                videoId: video.id,
                videoTitle: video.title,
                videoUploader: video.uploader,
                reportedBy: state.currentUser.username,
                reason: reason,
                timestamp: new Date().toISOString()
            };
            
            DB.reports.push(report);
            DB.save();
            
            showHint('Report submitted. Thank you!');
        }

        // Moderator functions
        function renderReports() {
            const reportsEl = document.getElementById('reportsList');
            reportsEl.innerHTML = '';
            
            if (DB.reports.length === 0) {
                reportsEl.innerHTML = '<p style="text-align: center; color: #aaa;">No reports yet.</p>';
                return;
            }
            
            DB.reports.slice().reverse().forEach(report => {
                const item = document.createElement('div');
                item.className = 'report-item';
                
                const date = new Date(report.timestamp).toLocaleString();
                
                item.innerHTML = `
                    <div class="report-header">
                        <span>Reported by: <strong>${report.reportedBy}</strong></span>
                        <span>${date}</span>
                    </div>
                    <div class="report-video">Video: ${report.videoTitle} (by ${report.videoUploader})</div>
                    <div class="report-reason">${report.reason}</div>
                    <div class="report-actions">
                        <button onclick="deleteReportedVideo(${report.videoId}, ${report.id})">Delete Video</button>
                        <button onclick="dismissReport(${report.id})">Dismiss Report</button>
                    </div>
                `;
                
                reportsEl.appendChild(item);
            });
        }

        function deleteReportedVideo(videoId, reportId) {
            if (!confirm('Are you sure you want to delete this video?')) {
                return;
            }
            
            DB.videos = DB.videos.filter(v => v.id !== videoId);
            DB.reports = DB.reports.filter(r => r.id !== reportId);
            DB.save();
            
            state.channels = state.channels.filter(ch => ch.id !== videoId);
            loadUserVideos();
            
            renderReports();
            showHint('Video deleted');
        }

        function dismissReport(reportId) {
            DB.reports = DB.reports.filter(r => r.id !== reportId);
            DB.save();
            
            renderReports();
            showHint('Report dismissed');
        }

        // Volume control
        volumeSlider.addEventListener('input', (e) => {
            videoPlayer.volume = e.target.value / 100;
        });

        // Brightness control
        brightnessSlider.addEventListener('input', (e) => {
            videoPlayer.style.filter = `brightness(${e.target.value}%)`;
        });

        // Mouse movement for TV tilt effect
        let mouseX = window.innerWidth / 2;
        let mouseY = window.innerHeight / 2;

        document.addEventListener('mousemove', (e) => {
            mouseX = e.clientX;
            mouseY = e.clientY;
        });

        function updateTVTilt() {
            if (tvContainer.classList.contains('visible')) {
                const centerX = window.innerWidth / 2;
                const centerY = window.innerHeight / 2;
                
                const rotateY = ((mouseX - centerX) / centerX) * 10;
                const rotateX = ((mouseY - centerY) / centerY) * -10;
                
                tvScreen.style.transform = `rotateX(${rotateX}deg) rotateY(${rotateY}deg)`;
            }
            
            requestAnimationFrame(updateTVTilt);
        }

        updateTVTilt();

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (tvContainer.classList.contains('visible')) {
                switch(e.key) {
                    case 'ArrowUp':
                        changeChannel(1);
                        break;
                    case 'ArrowDown':
                        changeChannel(-1);
                        break;
                    case 'Escape':
                        backToMenu();
                        break;
                }
            }
        });
    </script>
</body>
</html>
